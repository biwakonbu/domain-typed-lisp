# 複数ファイル入力と import MVP 設計

## Status
- Implemented（`dtl check <FILE>...` を実装済み）

## 1. 背景
- 実装前の CLI は `dtl check <FILE>` の単一ファイル入力のみを受け付けていた。
- ドメイン定義を運用する際、sort/relation/rule/defn を複数ファイルへ分割したい要求がある。
- 本言語の目的は汎用計算ではなく、型検査と論理導出によりドメイン制約の正しさを証明することにある。

## 2. 目的
- 最小 `import` を導入し、複数ファイルを 1 つの論理プログラムとして検証可能にする。
- 既存の検証パイプライン（parse -> resolve -> stratify -> typecheck）を維持する。

## 3. 非目的
- 名前空間分離、再エクスポート、公開/非公開制御。
- 依存順の自動解決。

## 4. 最小仕様
- CLI:
  - `dtl check <FILE>...`（1 つ以上）
- 意味論:
  - 指定されたファイル群と `import` で参照されたファイル群のトップレベルフォームを単純連結し、単一 `Program` として検査する。
  - フォーム評価順は指定順を保持するが、検査結果は順序不変であることを目標とする。
  - `sort` / `relation` / `defn` の重複は既存ルールどおり `E-RESOLVE`。
  - import 循環は `E-IMPORT` で拒否する。
- 診断:
  - parse 時点の診断メッセージにファイル名を付与する。
  - resolve 以降は Span にファイル識別子を導入するまで暫定で行・列のみを表示する。

## 5. 実装内容
1. `src/main.rs` の `check` 引数を `Vec<PathBuf>` 化。
2. 各ファイルを個別に parse し、`import` を再帰解決して AST をマージする。
3. `E-IO` / `E-PARSE` は `source`（ファイルパス）付きで出力する。
4. 単一ファイル入力時は resolve/typecheck 診断にも `source` を付与する。
5. import 循環時は `E-IMPORT` を返す。
6. JSON 出力の `diagnostics[]` へ `source` フィールドを追加する。

## 6. 受け入れ基準
- 既存単一ファイル入力は完全後方互換。
- 2 ファイル以上または import 利用時に、重複定義・未定義参照が既存エラーコードで検出される。
- テキスト/JSON いずれでも終了コード契約（成功 0 / 失敗 1）を維持する。

## 7. 未解決事項
- 複数ファイル入力時に resolve/typecheck 診断へ厳密な `source` を付与する設計（Span 拡張）をどうするか。
- ファイル順依存を完全に排除するための正規化が必要か。
